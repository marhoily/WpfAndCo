<#@ template language="C#" #>
using System;
using System.ComponentModel.DataAnnotations;

namespace Sample.Generated {
    [IoC]
    public sealed class Create<#=_type.Name#>Validator : IValidator<Create<#=_type.Name#>>
    {
<#
		//    ________
		//___/ Fields \________________________________________
    foreach (var p in _type.NavigationProperties)
    {
#>
		private readonly <#=p.ClrType.Name#>Aggregate <#=p.Name.AsField()#>Aggregate;
<#
        
    }
		//    _____________
		//___/ Constructor \___________________________________
#>	
		public Create<#=_type.Name#>Validator(
			<#=_type.NavigationProperties.Join(p 
				=> $"{p.ClrType.Name}Aggregate {p.Name.AsLocal()}Aggregate") #>)
		{
<#
    foreach (var p in _type.NavigationProperties)
    {
#>
			<#=p.Name.AsField()#>Aggregate = <#=p.Name.AsLocal()#>Aggregate;
<#
        
    }
#>	
		}
<#
		//    ____________
		//___/ Validate() \____________________________________
#>
		public ValidationResult Validate(Create<#=_type.Name#> commit)
		{
<#
    foreach (var p in _type.NavigationProperties)
    {
		if (!p.IsRequired)
		{
#>
			if (commit.<#=p.Name#> != Guid.Empty)
<#
		}
#>
			if (!<#=p.Name.AsField()#>Aggregate.ById.ContainsKey(commit.<#=p.Name#>))
				return new ValidationResult(
					"Wrong <#=p.Name#>: " + commit.<#=p.Name#>);
<#
    }
#>		
			return ValidationResult.Success;
		}
    }
}

<#+
    private readonly MetaType _type;
#>